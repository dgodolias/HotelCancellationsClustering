# Αναφορά Ομαδοποίησης Ακυρώσεων Ξενοδοχείων
Δημοσθένης Παναγιώτης Γκοντολιας (ΑΜ: 3220031)

## 1. Επισκόπηση Εργασίας
Ο στόχος αυτής της εργασίας είναι η ανάλυση δεδομένων κρατήσεων ξενοδοχείων για τον εντοπισμό διακριτών clusters πελατών με βάση τις συμπεριφορές και τα χαρακτηριστικά των κρατήσεών τους. Κατανοώντας αυτά τα τμήματα, στοχεύουμε να αποκτήσουμε γνώσεις σχετικά με τα μοτίβα ακυρώσεων.

## 2. Μεθοδολογία

### Feature Engineering
Παραγάγαμε αρκετά βασικά χαρακτηριστικά για την καλύτερη αποτύπωση της συμπεριφοράς των πελατών:
- **Arrival Month**: Υπολογίστηκε για την αποτύπωση της εποχικότητας.
- **Total Guests**: Άθροισμα ενηλίκων και παιδιών.
- **Is Family**: Binary feature για κρατήσεις με παιδιά.
- **Total Nights**: Άθροισμα διανυκτερεύσεων καθημερινών και σαββατοκύριακων.
- **Cancellation Ratio**: Μια αναλογία προηγούμενων ακυρώσεων για επαναλαμβανόμενους πελάτες με εξομάλυνση Laplace.
- **Price per Person**: Μέση τιμή διαιρεμένη με το σύνολο των επισκεπτών.
- **Meal Type & Room Type**: Αρχικά δημιουργήθηκαν κατηγορικές μεταβλητές για τον τύπο γεύματος και δωματίου.
- **Encoding**: Εφαρμογή one-hot encoding σε κατηγορικές μεταβλητές (`market.segment.type`, `room.type`, `type.of.meal`) για τους λόγους ότι οι τιμές της ειναι strings και δεν υπάρχει η έννοια της απόστασης. Όμως και ως αριθμητικές τιμές να τις αντιπροσωπεύσουμε, πάλι δεν έχει νόημα η ευκλέιδια απόσταση πχ να μην θεωρησει οτι το 2 ειναι πιο κοντα στο 1 απο το 3.
    - **Room Type**: `room.type_Room_Type 2` έως `room.type_Room_Type 7`
    - **Meal Type**: `type.of.meal_Meal Plan 2` έως `type.of.meal_Meal Plan 3`
    - **Market Segment**: `market.segment.type_Complementary`, `market.segment.type_Corporate`, `market.segment.type_Offline`, `market.segment.type_Online`
- **Drop First**: Ορισμός του `drop_first=True` για να αποφύγουμε το dummy variable trap. Για αυτόν τον λόγο δεν έχουν χρησιμοποιηθεί `room.type_Room_Type 1`, `type.of.meal_Meal Plan 1`, `market.segment.type_Aviation`.

### Preprocessing
- **Data Cleaning**: Χειρισμός μη έγκυρων ημερομηνιών και ελλειπών τιμών.
- **Binning**: Ομαδοποίηση σπάνιων τιμών σε χαρακτηριστικά όπως `number.of.children`, `Total_Guests` και `Total_Nights` για μείωση του θορύβου:
#### Μεταβλητές με Binning:
1. **number.of.children**: 0, 1+ (αντί για 0, 1, 2, 3, κλπ)
2. **number.of.weekend.nights**: 0, 1, 2, 3+
3. **number.of.week.nights**: Κανονικά ως το 5, μετά 6+
4. **P.C (Previous Cancellations)**: 0, 1+
5. **P.not.C (Previous Non-Cancellations)**: 0, 1+
6. **Total_Guests**: 1, 2, 3+
   - Όσα είναι 0 γίνονται 1 (διόρθωση)
7. **Total_Nights**: Κανονικά ως το 7, μετά 8+

- **Scaling**: Κανονικοποίηση αριθμητικών χαρακτηριστικών στο εύρος [-1, 1] για να διασφαλιστεί η ίση συμβολή στους υπολογισμούς αποστάσεων, αφού υπάρχουν αριθμητικές τιμές που είναι πολύ μεγαλύτερες απο τις άλλες. Έτσι, δεν θα δωθεί περισσότερη βαρύτητα σε μια μεταβλητή λόγω των μεγάλων τιμών. 
- Παραδειγμα, μια παρατηρηση με lead.time=100 & total.guests=2 θα είναι πιο κοντά στην παρατήρηση με lead.time=100 & total.guests=5, παρά την παρατήρηση με lead.time=105 & total.guests=2.

### Clustering
Χρησιμοποιήσαμε δύο κύριους αλγόριθμους clustering για να εξασφαλίσουμε την εγκυρότητα των αποτελεσμάτων:

1. **K-Means Clustering**:
   - **Λειτουργία**: Ένας επαναληπτικός αλγόριθμος που χωρίζει τα δεδομένα σε $k$ ομάδες, ελαχιστοποιώντας την απόσταση των σημείων από το κέντρο της ομάδας τους (centroid).
   - **Παράμετροι**:
     - `centers = k`: Ο αριθμός των ομάδων που δοκιμάσαμε (από 2 έως 10).
     - `nstart = 10`: Ο αλγόριθμος έτρεξε 10 φορές με τυχαία αρχικά κέντρα για να αποφύγουμε τοπικά ελάχιστα και να διασφαλίσουμε τη σταθερότητα της λύσης.
   - **Απόσταση**: Ευκλείδεια απόσταση.

2. **Hierarchical Clustering**:
   - **Λειτουργία**: Κατασκευάζει μια ιεραρχία ομάδων συγχωνεύοντας σταδιακά τα πιο κοντινά σημεία.
   - **Linkage**: `ward.D2`. Η μέθοδος Ward ελαχιστοποιεί τη διακύμανση μέσα στις ομάδες κατά τη συγχώνευση, οδηγώντας σε συμπαγείς και σφαιρικές ομάδες, παρόμοιες με αυτές του K-Means.
   - **Απόσταση**: Ευκλείδεια απόσταση.

## 3. Ανάλυση & Βελτιστοποίηση

### Καθορισμός Βέλτιστου k
Αξιολογήσαμε τον αριθμό των ομάδων k χρησιμοποιώντας Silhouette Score, Elbow Method, NMI και ARI.
- Η αρχική ανάλυση πρότεινε k=3, αλλά περαιτέρω βελτιστοποίηση αποκάλυψε μια ισχυρότερη δομή στο **k=4**.

### Feature Elimination (Stepwise Process)
Η διαδικασία επιλογής χαρακτηριστικών έγινε βηματικά (stepwise), αφαιρώντας μεταβλητές που πρόσθεταν θόρυβο και χειροτέρευαν το Silhouette Score για $k=3$. Παρατηρήσαμε ότι καθώς αφαιρούσαμε τον θόρυβο, οι μετρικές γίνονταν πιο "σίγουρες", αλλά το βέλτιστο $k$ μετατοπίστηκε από το 3 στο 4, γεγονός ιδιαίτερα ενδιαφέρον.

*Σημείωση: Οι δοκιμές με stepwise και η αρχική επιλογή μεταβλητών πραγματοποιήθηκαν προσωπικά σε Python για διευκόλυνση, καθώς είμαι φοιτητής πληροφορικής. Για αυτόν τον λόγο, τα γραφήματα στα βήματα 1-4 αυτής της ενότητας έχουν διαφορετικά χρώματα και τεχνικά χαρακτηριστικά από το τελικό γράφημα αξιολόγησης ομαδοποίησης, το οποίο δημιουργήθηκε σε R. Η τελική εργασία, ωστόσο με βαση τις ακαδημαικές οδηγίες, υλοποιήθηκε πλήρως σε R και ο κώδικας έχει παρατεθεί για επιβεβαίωση.*

Η εξέλιξη της βελτίωσης φαίνεται στα παρακάτω βήματα:

1.  **Step 1 (Initial State)**: Όλες οι μεταβλητές συμπεριλαμβανομένων των `meal type` και `room type`, χωρίς scaling.
    ![Output 1 - Initial](R/old_visuals/output1.png)
    *Εδώ παρατηρούμε χαμηλό διαχωρισμό.*

2.  **Step 2 (Scaling)**: Εφαρμογή scaling στις μεταβλητές.
    ![Output 2 - Scaled](R/old_visuals/output2.png)
    *Παρατηρήθηκε εμφανής βελτίωση στη δομή των ομάδων.*

3.  **Step 3 (Categorical Removal)**: Αφαίρεση των κατηγορικών μεταβλητών που προέκυψαν από `type.of.meal` και `room.type` για μείωση θορύβου.
    ![Output 3 - No Categoricals](R/old_visuals/output3.png)

4.  **Step 4 (Temporal Removal)**: Αφαίρεση των μεταβλητών `arrival.year` και `date.of.reservation`.
    ![Output 4 - Final](R/old_visuals/output4.png)
    *Η τελική μορφή όπου αναδείχθηκε το k=4 ως βέλτιστη λύση.*

### Σύγκριση Αλγορίθμων (Algorithm Comparison)
Για να επιβεβαιώσουμε τη σταθερότητα των ομάδων, συγκρίναμε τα αποτελέσματα του K-Means με αυτά της Ιεραρχικής Ομαδοποίησης χρησιμοποιώντας τους δείκτες **NMI (Normalized Mutual Information)** και **ARI (Adjusted Rand Index)**.

| k | NMI | ARI | Σχόλια |
|---|---|---|---|
| 2 | 0.9299 | 0.9661 | Πολύ υψηλή συμφωνία |
| 3 | 0.9652 | 0.9824 | Εξαιρετική συμφωνία |
| **4** | **0.9755** | **0.9884** | **Μέγιστη συμφωνία - Βέλτιστη λύση** |
| 5 | 0.7611 | 0.6187 | Σημαντική πτώση στη συμφωνία |

Η εξαιρετικά υψηλή τιμή των δεικτών για $k=4$ (NMI > 0.97, ARI > 0.98) υποδεικνύει ότι και οι δύο αλγόριθμοι εντοπίζουν σχεδόν την ίδια δομή στα δεδομένα, ενισχύοντας την εμπιστοσύνη μας στην επιλογή των 4 ομάδων.

**Τελικά Αποτελέσματα (k=4):**
- **Silhouette Score**: ~0.49 (Υψηλή ποιότητα)
- **NMI / ARI**: > 0.97 (Εξαιρετική συμφωνία μεταξύ K-Means και Ιεραρχικής)

![Αξιολόγηση Ομαδοποίησης](R/visuals/clustering_evaluation.png)

## 4. Cluster Profiles

Με βάση την τελική ομαδοποίηση, εντοπίσαμε 4 διακριτά προφίλ πελατών:

### Cluster 0: Τυπικά Online Ζευγάρια
- **Προφίλ**: Ζευγάρια που ταξιδεύουν για αναψυχή.
- **Βασικά Χαρακτηριστικά**: 2 ενήλικες, 0 παιδιά, υψηλή τιμή ανά άτομο.
- **Κανάλι Κράτησης**: Αποκλειστικά **Online**.
- **Ρίσκο**: Υψηλό ποσοστό ακύρωσης (~37%).

### Cluster 1: Offline / Έγκαιροι Προγραμματιστές (Early Birds)
- **Προφίλ**: Ταξιδιώτες μεγαλύτερης ηλικίας ή γκρουπ που προγραμματίζουν πολύ νωρίτερα.
- **Βασικά Χαρακτηριστικά**: Μεγαλύτερος **Χρόνος Προετοιμασίας (Lead Time)**, χαμηλότερη μέση τιμή.
- **Κανάλι Κράτησης**: **Offline** (Ταξιδιωτικοί Πράκτορες/Τηλέφωνο).
- **Ρίσκο**: Μεσαίο-Υψηλό ποσοστό ακύρωσης (~30%).

### Cluster 2: Premium Οικογένειες
- **Προφίλ**: Οικογένειες σε διακοπές.
- **Βασικά Χαρακτηριστικά**: Παρουσία **παιδιών**, υψηλότερη συνολική τιμή, τα περισσότερα ειδικά αιτήματα.
- **Κανάλι Κράτησης**: **Online**.
- **Ρίσκο**: Υψηλότερο ποσοστό ακύρωσης (~40%) λόγω υψηλού κόστους και πολυπλοκότητας του οικογενειακού ταξιδιού.

### Cluster 3: Πιστοί Εταιρικοί Πελάτες (Loyal Corporate)
- **Προφίλ**: Επαγγελματίες ταξιδιώτες και συχνοί επισκέπτες.
- **Βασικά Χαρακτηριστικά**: **Επαναλαμβανόμενοι** επισκέπτες, ιστορικό μη ακυρώσεων, ανάγκη για πάρκινγκ.
- **Κανάλι Κράτησης**: **Corporate**, Aviation, Complementary.
- **Ρίσκο**: Χαμηλότερο ποσοστό ακύρωσης (~11%).

## 5. Οπτικοποιήσεις

### Κατανομές Χαρακτηριστικών
![Πλέγμα Κατανομών 1](R/visuals/dist_grid_1.png)
![Πλέγμα Κατανομών 2](R/visuals/dist_grid_2.png)
![Πλέγμα Κατανομών 3](R/visuals/dist_grid_3.png)
![Πλέγμα Κατανομών 4](R/visuals/dist_grid_4.png)

### Συγκρίσεις Ομάδων
![Πλέγμα Συγκρίσεων Ομάδων 1](R/visuals/cluster_comp_grid_1.png)
![Πλέγμα Συγκρίσεων Ομάδων 2](R/visuals/cluster_comp_grid_2.png)
![Πλέγμα Συγκρίσεων Ομάδων 3](R/visuals/cluster_comp_grid_3.png)
![Πλέγμα Συγκρίσεων Ομάδων 4](R/visuals/cluster_comp_grid_4.png)
![Πλέγμα Συγκρίσεων Ομάδων 5](R/visuals/cluster_comp_grid_5.png)

### Θερμικός Χάρτης Ομάδων (Heatmap)
![Θερμικός Χάρτης Ομάδων](R/visuals/cluster_heatmap.png)

### Ποσοστά Ακυρώσεων
![Ποσοστά Ακυρώσεων](R/visuals/cancellation_rate.png)

## 6. Συμπέρασμα
Η ανάλυση τμηματοποίησε επιτυχώς τους επισκέπτες του ξενοδοχείου σε τέσσερις αξιοποιήσιμες ομάδες. Το τμήμα "Πιστοί Εταιρικοί Πελάτες" παρέχει μια σταθερή βάση εσόδων με χαμηλό ρίσκο, ενώ τα τμήματα "Premium Οικογένειες" και "Τυπικά Online Ζευγάρια" παράγουν υψηλά έσοδα αλλά συνοδεύονται από σημαντικούς κινδύνους ακύρωσης. Στρατηγικές όπως μη επιστρεπτέες τιμές ή στοχευμένες πολιτικές προκαταβολών θα μπορούσαν να βοηθήσουν στον μετριασμό αυτών των κινδύνων για τα τμήματα με υψηλά ποσοστά ακύρωσης.
